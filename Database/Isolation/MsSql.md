## Уровни изоляции транзакций MsSQL

При конкуретном доступе к данным могу возникнуть следующие проблемы

Грязное чтение - чтение данных незафиксированных транзакций
Неповторяющееся чтение - изменение данных второй транзакцией во время выполнения первой.
Фантомы - добавление строк второй транзакцией во время выполнения первой

### Виды блокировок
Совмещаемая блокировка - используется для операций считывания (Select) и предотвращают изменение (Update, Delete) заблокированного ресурса. Этот вид блокировки может быть совмещен с другими блокировками.
В зависимости от уровня изоляции, блокировка может быть снята, как только данные считаны (READ COMMITERD), либо же удерживаться до конца транзакций (REPEATABLE READ и выше)

Монопольная блокировка - испльзуется для операций изменения данных (Update, Delete). Данная блокировка не может быть установлена, если существуют какие-либо другие блокировки на ресурсе. Будучи успешно установленной, данная блокировка не позволяет установку новых блокировок любых типов, т.е. все запросы, пытающиеся получить доступ к ресурсу, будут ожить сниятия монопольной блокировки.

Блокировка обновления - оптимизация монопольный блокировки на UPDATE. Процесс обновления данных можно разделить на два этапа:
- Поиск данных для обновления
- Обновление найденных данных

Если монопольная блокировка будет установлена во время поиска данных на обновление, то заблокируем чтение данных для других транзакций.
Поэтому во врнмя поиска данных устанавливается совмещаемая блокировка, а на обновление монопольная.

### Read Uncommited 
image.png
В режиме Read Uncommited из первого сеанса можно видеть все незафиксированные транзакции второго сеанса.
Проблемы:
- Грязное чтение
- Неповторяющееся чтение
- Фантомы

### Read Commited
![image](https://hsto.org/r/w1560/getpro/habr/upload_files/a72/98d/34d/a7298d34d944d67f13430cb254ff00c8.jpg)
Позволяет читать данные только зафиксированных транзакций.Использует совмещаемую блокировку для SELECT. Использует монопольные блокировки только для UPDATE, DELETE. Из другой транзакции можно обновить незаблокированную запись
Проблемы:
- Неповторяющееся чтение
- Фантомы


### Repeatable read
![image](https://hsto.org/getpro/habr/upload_files/b83/d5e/8ec/b83d5e8eca1d859fbf4ca7a881ee6291.jpg)
Позволяет читать данные только зафиксированных транзакций. Использует монопольные блоировки для выбранных записей(Select), а также Update, Delete. Так как блокирует прочитанные записи для модификации и удаления, исключает проблемы неповторяющегося чтения. Позволяет из другой транзакции делать вставку. Проблемы:
- Фантомы


### Serializable 

Монопольно блокирует выбранные данные, а так же не позволяет делать вставку до окончания транзакции.
Проблемы:
- Очень низкая производительность при конкурентном доступе